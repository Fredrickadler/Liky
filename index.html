<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liky Pro - Social Engagement Platform</title>
    
    <!-- Farcaster Meta -->
    <meta name="fc:frame" content='{
        "version":"next",
        "imageUrl":"https://i.imgur.com/UxZ1DqS_d.webp?maxwidth=1520&fidelity=grand",
        "button":{
            "title":"Liky Pro",
            "action":{
                "type":"launch_frame",
                "url":"https://liky-pro.vercel.app",
                "name":"Liky!",
                "splashImageUrl":"https://i.imgur.com/nyI4nlz_d.webp?maxwidth=1520&fidelity=grand",
                "splashBackgroundColor":"#2E2E2E"
            }
        }
    }'>

    <!-- Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@farcaster/frame-sdk"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #8A5AFF;
            --primary-dark: #6E3AFF;
            --background: #0F0F0F;
            --surface: #1A1A1A;
            --border: #2E2E2E;
            --text-primary: #FFFFFF;
            --text-secondary: #A0A0A0;
            --success: #4CAF50;
            --error: #FF4D4D;
            --gold: #FFD700;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--background);
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
            min-height: 100vh;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 15, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--surface);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: 20px;
            color: var(--text-secondary);
            animation: pulse 1.5s infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Main Container */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .connect-button {
            background: var(--primary);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .connect-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .wallet-address {
            background: var(--surface);
            padding: 10px 20px;
            border-radius: 8px;
            display: none;
        }

        /* Post Feed */
        .post-feed {
            display: grid;
            gap: 25px;
            margin-bottom: 40px;
        }

        .post-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 25px;
            transition: transform 0.3s;
        }

        .post-card:hover {
            transform: translateY(-5px);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--primary);
        }

        .post-content img {
            width: 100%;
            border-radius: 12px;
            margin-top: 15px;
        }

        .post-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .like-button {
            background: var(--primary);
            color: white;
        }

        /* Leaderboard */
        .leaderboard-section {
            background: var(--surface);
            border-radius: 16px;
            padding: 25px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background: var(--background);
            border-radius: 12px;
        }

        .rank-badge {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 700;
        }

        /* Profile Section */
        .profile-section {
            background: var(--surface);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--primary);
            margin-bottom: 20px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .post-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
        <p class="loading-text">Initializing Application</p>
    </div>

    <div class="app-container">
        <header class="app-header">
            <h1>Liky Pro</h1>
            <div class="wallet-section">
                <button class="connect-button" id="connectButton">
                    <i class="fas fa-wallet"></i>
                    Connect Wallet
                </button>
                <div class="wallet-address" id="walletAddress"></div>
            </div>
        </header>

        <main>
            <section class="post-feed" id="postFeed"></section>
            <section class="leaderboard-section" id="leaderboard"></section>
            <section class="profile-section" id="profile"></section>
        </main>
    </div>

    <script type="module">
        import sdk from 'https://esm.sh/@farcaster/frame-sdk';

        class LikyApp {
            constructor() {
                this.state = {
                    currentUser: null,
                    posts: [],
                    leaderboard: [],
                    currentPostIndex: 0
                };
                
                this.init();
            }

            async init() {
                try {
                    await this.initializeSDK();
                    await this.loadData();
                    this.setupEventListeners();
                    this.updateUI();
                    this.hideLoading();
                } catch (error) {
                    this.handleError(error);
                }
            }

            async initializeSDK() {
                await sdk.actions.ready();
                if (window.sdk?.wallet?.ethProvider) {
                    this.provider = new ethers.BrowserProvider(window.sdk.wallet.ethProvider);
                    this.signer = await this.provider.getSigner();
                    this.state.currentUser = {
                        address: await this.signer.getAddress(),
                        balance: 100,
                        likes: 0,
                        following: []
                    };
                }
            }

            async loadData() {
                this.state.posts = await this.fetchPosts();
                this.state.leaderboard = await this.fetchLeaderboard();
            }

            async fetchPosts() {
                return [
                    {
                        id: 1,
                        user: '@fredrickadler',
                        content: 'Building the future of decentralized social media! 🚀',
                        image: 'https://i.imgur.com/muoYEIu.jpeg',
                        likes: 142,
                        url: 'https://warpcast.com/fredrickadler/0x3606f806',
                        type: 'like'
                    },
                    {
                        id: 2,
                        user: '@web3builder',
                        content: 'Join our community and earn rewards! 🎉',
                        image: 'https://i.imgur.com/abc123.jpg',
                        likes: 89,
                        url: 'https://warpcast.com/web3builder/0x8c05d3a7',
                        type: 'follow'
                    }
                ];
            }

            async fetchLeaderboard() {
                return [
                    { rank: 1, username: '@topuser1', score: 1245 },
                    { rank: 2, username: '@topuser2', score: 1120 },
                    { rank: 3, username: '@topuser3', score: 980 }
                ];
            }

            setupEventListeners() {
                document.getElementById('connectButton').addEventListener('click', () => this.connectWallet());
                window.handleLike = (postId) => this.handleLike(postId);
                window.viewPost = (url) => this.viewPost(url);
                window.skipPost = () => this.skipPost();
            }

            async connectWallet() {
                try {
                    await this.initializeSDK();
                    this.updateUI();
                } catch (error) {
                    alert('Wallet connection failed: ' + error.message);
                }
            }

            handleLike(postId) {
                const post = this.state.posts.find(p => p.id === postId);
                if (post) {
                    post.likes++;
                    this.state.currentUser.balance++;
                    this.updateUI();
                }
            }

            viewPost(url) {
                window.open(url, '_blank');
            }

            skipPost() {
                this.state.currentPostIndex = 
                    (this.state.currentPostIndex + 1) % this.state.posts.length;
                this.updateUI();
            }

            updateUI() {
                this.renderPosts();
                this.renderLeaderboard();
                this.renderProfile();
                this.updateWalletDisplay();
            }

            renderPosts() {
                const postFeed = document.getElementById('postFeed');
                postFeed.innerHTML = this.state.posts.map(post => `
                    <article class="post-card">
                        <div class="post-header">
                            <img src="${post.image}" class="user-avatar" alt="${post.user}">
                            <h3>${post.user}</h3>
                        </div>
                        <div class="post-content">
                            <p>${post.content}</p>
                            ${post.image ? `<img src="${post.image}" class="post-image" alt="Post">` : ''}
                        </div>
                        <div class="post-actions">
                            <button class="action-button like-button" 
                                    onclick="handleLike(${post.id})">
                                <i class="fas fa-heart"></i>
                                Like (${post.likes})
                            </button>
                            <button class="action-button" onclick="viewPost('${post.url}')">
                                <i class="fas fa-external-link-alt"></i>
                                View Post
                            </button>
                            <button class="action-button" onclick="skipPost()">
                                <i class="fas fa-forward"></i>
                                Skip
                            </button>
                        </div>
                    </article>
                `).join('');
            }

            renderLeaderboard() {
                const leaderboard = document.getElementById('leaderboard');
                leaderboard.innerHTML = `
                    <h2>🏆 Leaderboard</h2>
                    ${this.state.leaderboard.map(user => `
                        <div class="leaderboard-item">
                            <div class="rank-badge" style="background: ${this.getRankColor(user.rank)}">
                                ${user.rank}
                            </div>
                            <div>
                                <h3>${user.username}</h3>
                                <p>🪙 ${user.score} COINS</p>
                            </div>
                        </div>
                    `).join('')}
                `;
            }

            renderProfile() {
                const profile = document.getElementById('profile');
                if (!this.state.currentUser) return;

                profile.innerHTML = `
                    <img src="https://i.imgur.com/ABCD5678.jpg" class="profile-avatar" alt="Profile">
                    <h2>${this.state.currentUser.address.slice(0, 6)}...${this.state.currentUser.address.slice(-4)}</h2>
                    <div class="profile-stats">
                        <div>
                            <h3>${this.state.currentUser.balance}</h3>
                            <p>COINS</p>
                        </div>
                        <div>
                            <h3>${this.state.currentUser.likes}</h3>
                            <p>LIKES</p>
                        </div>
                        <div>
                            <h3>${this.state.currentUser.following.length}</h3>
                            <p>FOLLOWING</p>
                        </div>
                    </div>
                `;
            }

            updateWalletDisplay() {
                const walletAddress = document.getElementById('walletAddress');
                if (this.state.currentUser) {
                    document.getElementById('connectButton').style.display = 'none';
                    walletAddress.style.display = 'block';
                    walletAddress.textContent = `${this.state.currentUser.address.slice(0, 6)}...${this.state.currentUser.address.slice(-4)}`;
                }
            }

            getRankColor(rank) {
                return {
                    1: 'var(--gold)',
                    2: 'var(--silver)',
                    3: 'var(--bronze)'
                }[rank] || 'var(--surface)';
            }

            hideLoading() {
                document.getElementById('loading').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 300);
            }

            handleError(error) {
                console.error('Application Error:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h2 style="color: var(--error)">⚠️ Application Error</h2>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" 
                                style="margin-top: 15px; padding: 10px 20px; background: var(--primary); border: none; border-radius: 8px; cursor: pointer;">
                            Reload Application
                        </button>
                    </div>
                `;
            }
        }

        // Initialize Application
        new LikyApp();
    </script>
</body>
</html>